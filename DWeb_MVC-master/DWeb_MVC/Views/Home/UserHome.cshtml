@model List<DWeb_MVC.Models.Produtos>

@{
    ViewData["Title"] = "Página Inicial";
    Layout = "~/Views/Shared/_LayoutPublic.cshtml";

    var grupos = new Dictionary<string, int>
    {
        { "Cavalo", 1 },
        { "Cavaleiro", 2 },
        { "Estábulo", 3 }
    };
}

<div id="hero-section">
    <div id="carouselLoja" class="carousel slide" data-bs-ride="carousel" data-bs-interval="9000">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="~/imagens/carrosel/LogoGoldStirrup.png" alt="Imagem 1" />
            </div>
            <div class="carousel-item">
                <img src="~/imagens/carrosel/CarrosselImage2.png" alt="Imagem 2" />
            </div>
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#carouselLoja" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselLoja" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
            <span class="visually-hidden">Seguinte</span>
        </button>
    </div>
</div>

@foreach (var grupo in grupos)
{
    var produtosDoGrupo = Model
        .Where(p => p.Categoria != null && p.Categoria.Any(c => c.GruposId == grupo.Value))
        .OrderBy(p => Guid.NewGuid()) 
        .Take(3)
        .ToList(); 

    <section class="categoria-bloco my-5 py-4 px-3 bg-white shadow rounded">
        <div class="container">
            <h2 class="mb-3">@grupo.Key</h2>
            <p class="mb-4 text-muted">
                @(grupo.Key == "Cavalo" ? "Na equitação a relação entre cavalo e cavaleiro é essencial..."
                    : grupo.Key == "Cavaleiro" ? "Proteja-se com conforto e elegância..."
                    : "Organização, higiene e bem-estar para o seu cavalo e o seu espaço...")
            </p>

            @if (produtosDoGrupo.Any())
            {
                <div class="row">
                    @foreach (var produto in produtosDoGrupo)
                    {
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 produto-card"
                                 data-bs-toggle="modal"
                                 data-bs-target="#produtoModal"
                                 data-nome="@produto.Nome"
                                 data-marca="@produto.Marca"
                                 data-preco="@produto.Preco.ToString("C")"
                                 data-categoria="@string.Join(", ", produto.Categoria.Select(c => c.Nome))"
                                 data-imagem="~/imagens/@(produto.Fotos.FirstOrDefault()?.NomeFicheiro ?? "noProduto.jpg")">
                                <img src="~/imagens/@(produto.Fotos.FirstOrDefault()?.NomeFicheiro ?? "noProduto.jpg")" class="card-img-top" alt="@produto.Nome" />
                                <div class="card-body">
                                    <h5 class="card-title">@produto.Nome</h5>
                                    <p class="card-text">@produto.Marca</p>
                                    <p class="card-text"><strong>@produto.Preco.ToString("C")</strong></p>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="text-center mt-3">
                    <a href="#" class="btn btn-outline-primary">Ver todos os Produtos</a>
                </div>
            }
            else
            {
                <p>Nenhum produto disponível neste momento.</p>
            }
        </div>
    </section>
}

<!-- pop up produto -->
<div class="modal fade" id="produtoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="background-color: #3a250e; color: #fff;">
            <div class="modal-header">
                <h5 class="modal-title">Detalhes do Produto</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalImagem" src="" alt="Imagem Produto" class="img-fluid mb-3" />
                <p><strong>Nome:</strong> <span id="modalNome"></span></p>
                <p><strong>Marca:</strong> <span id="modalMarca"></span></p>
                <p><strong>Preço:</strong> <span id="modalPreco"></span></p>
                <p><strong>Categoria:</strong> <span id="modalCategoria"></span></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light">Adicionar ao Carrinho</button>
            </div>
        </div>
    </div>
</div>

<script>
    const produtoModal = document.getElementById('produtoModal');
    produtoModal.addEventListener('show.bs.modal', function (event) {
        const card = event.relatedTarget;
        document.getElementById('modalNome').textContent = card.getAttribute('data-nome');
        document.getElementById('modalMarca').textContent = card.getAttribute('data-marca');
        document.getElementById('modalPreco').textContent = card.getAttribute('data-preco');
        document.getElementById('modalCategoria').textContent = card.getAttribute('data-categoria');
        document.getElementById('modalImagem').src = card.getAttribute('data-imagem').replace('~', '');
    });
</script>
